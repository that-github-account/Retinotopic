<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Collison Animation</title>
    <style>
        canvas {
            padding: 0;
            margin: auto;
            display: block;
        };
    </style>
</head>

<body onload="onShow()">
    <canvas id="canvas" width="1000" height="500" style="background-color: black;"></canvas>

    <p id="testing"> This is is before. </p>

<script>

    //some settings



    //self.adjective = Math.random()>0.5 ? "test" : "notest";
    //self.paragraph = document.getElementById("testing");
    //paragraph.innerHTML = self.adjective;

    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");

    //internal canvas resolution
    var canvas_width = canvas.width;
    var canvas_height = canvas.height;

    //window size (excluding toolbar etc.)
    var window_width = window.innerWidth;
    var window_height = window.innerHeight;

    var window_centrex = window_width/2;
    var window_centrey = window_height/2;

    var fixation_location = "left";
    var fixation_offset = 0;

    let fixation_xpos;
    if (fixation_location == "left") {
        fixation_xpos = (canvas.width/2) - fixation_offset;
    } else {
        fixation_xpos = (canvas.width/2) + fixation_offset;
    };

    var fixation_ypos = window_centrey;

    var circle_xpos_window = canvas_width/2;
    var circle_ypos_window = canvas_height/2;

    var circle_size = 10;
    var circle_colour = "#808080";

    var fixation_size = 40;
    var fixation_colour = "#ff0000";

    //development functions (check all false when running experiment)

    const assist_centre = false;
    const assist_grid = false;
    const assist_text = true;

    function onShow() { //define variables here

        const Circle1 = new CollisionCircles(circle_xpos_window, circle_ypos_window, circle_size, circle_colour);
        const FixationCross1 = new FixationCross(fixation_xpos, fixation_ypos, fixation_size, fixation_colour);

        
        this.objects = Circle1;
        this.FixationCross = FixationCross1;
        window.requestAnimationFrame(this.drawScene);

    };

    this.drawScene = function() { //play the animation here   
        ctx.clearRect(0, 0, canvas.width, canvas.height);     

        this.objects.draw(canvas);
        this.objects.movecircle1tocentre();


        //leave as is

        if (assist_centre == true) {
            ctx.beginPath();
            ctx.fillStyle = "#000000";
            ctx.arc(canvas.width/2, canvas.height/2, 10, 0, 2 * Math.PI);
            ctx.fill();
        };

        if(assist_grid == true) {
            ctx.beginPath();
            ctx.fillStyle = "green";
            ctx.arc(objects.startx, objects.starty, 10, 0, 2 * Math.PI);
            ctx.fill();

            ctx.beginPath();
            ctx.fillStyle = "#ff0000";
            ctx.arc(objects.centrex, objects.centrey, 10, 0, 2 * Math.PI);
            ctx.fill();

            ctx.beginPath();
            ctx.fillStyle = "orange";
            ctx.arc(objects.endx, objects.endy, 10, 0, 2 * Math.PI);
            ctx.fill();
        };

        if(assist_text == true) {
            ctx.fillStyle = "green";
            ctx.fillText("1", objects.circle1x, objects.circle1y);
            ctx.fillStyle = "orange";
            ctx.fillText("2", objects.circle2x, objects.circle2y);
        };

        window.requestAnimationFrame(this.drawScene)

    }

    //add functions below

    function CollisionCircles(xpos, ypos, size, colour) {
        this.xpos = xpos;
        this.ypos = ypos;
        this.size = size;
        this.colour = colour;

        this.distance = 50;
        this.angle = 45;
        this.radian = this.angle*(Math.PI/180);
        this.overlap = 0;

        this.centrex = this.xpos;
        this.centrey = this.ypos;

        this.startx = this.centrex - Math.cos(this.radian)*this.distance;
        this.starty = this.centrey + Math.sin(this.radian)*this.distance;

        this.endx = this.centrex + Math.cos(this.radian)*this.distance;
        this.endy = this.centrey - Math.sin(this.radian)*this.distance;

        this.circle1x = this.startx;
        this.circle1y = this.starty;

        this.circle2x = this.centrex - Math.cos(this.radian)*(this.overlap); 
        this.circle2y = this.centrey + Math.sin(this.radian)*(this.overlap);
        
        this.draw = function(canvas) {
            ctx.beginPath();
            ctx.fillStyle = this.colour;
            ctx.arc(this.circle1x, this.circle1y, this.size, 0, 2 * Math.PI);
            ctx.fill();

            ctx.beginPath();
            ctx.fillStyle = "blue";
            ctx.arc(this.circle2x, this.circle2y, this.size, 0, 2 * Math.PI);
            ctx.fill();
        };

        this.movecircle1tocentre = function() {

            var speed = 1

            var distanceX = Math.abs(this.circle1x - this.centrex);
            var distanceY = Math.abs(this.circle1y - this.centrey);

            if (distanceX > 0.1 || distanceY > 0.1) {
                this.circle1x = this.circle1x + Math.cos(this.radian)*speed;
                this.circle1y = this.circle1y - Math.sin(this.radian)*speed;    
            };

            console.log(this.circle1x, this.circle1y, "centre", this.centrex, this.centrey)
        };

        this.movecircle2toend = function() {

            var speed = 1

            var distanceX = Math.abs(this.circle2x - this.endx)
            var overX = this.size*Math.abs(Math.cos(this.radian))*(this.overlap)
            var distanceY = Math.abs(this.circle2y - this.endy) 
            var overY = this.size*Math.abs(Math.sin(this.radian))*(this.overlap)
            console.log(distanceX, distanceY)
            if(distanceX > (0 + overX) || distanceY > (0 + overY)) {
                this.circle2x = this.circle2x + Math.cos(this.radian)*speed;
                this.circle2y = this.circle2y - Math.sin(this.radian)*speed;
            };
        };

        this.playanimation = function() {
            this.movecircle1tocentre();
            this.movecircle2toend();
        }
    };

    function FixationCross(xpos, ypos, size, colour) {
        this.xpos = xpos;
        this.ypos = ypos;
        this.size = size;
        this.colour = colour;

        this.rec1sizex = this.size;
        this.rec1sizey = this.size/4;
        this.rec1x = this.xpos - this.rec1sizex/2;
        this.rec1y = this.ypos - this.rec1sizey/2;

        this.rec2sizex = this.size/4;
        this.rec2sizey = this.size;
        this.rec2x = this.xpos - this.rec2sizex/2;
        this.rec2y = this.ypos - this.rec2sizey/2;

        this.draw = function(canvas) {
            var ctx = canvas.getContext("2d");

            ctx.fillStyle = this.colour;
            ctx.fillRect(this.rec1x, this.rec1y, this.rec1sizex, this.rec1sizey);
            ctx.fillRect(this.rec2x, this.rec2y, this.rec2sizex, this.rec2sizey);
        };
    };
</script>
</body>
</html>