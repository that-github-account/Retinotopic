<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Collison Animation</title>
    <style>
        canvas {
            padding: 0;
            margin: auto;
            display: block;
        };
    </style>
</head>

<body onload="onShow()">
    <canvas id="canvas" width="1000" height="500" style="background-color: black;"></canvas>

    <p id="testing"> This is is before. </p>

<script>

    //some settings



    //self.adjective = Math.random()>0.5 ? "test" : "notest";
    //self.paragraph = document.getElementById("testing");
    //paragraph.innerHTML = self.adjective;

    var canvas = document.getElementById("canvas");

    //internal canvas resolution
    var canvas_width = canvas.width;
    var canvas_height = canvas.height;

    //window size (excluding toolbar etc.)
    var window_width = window.innerWidth;
    var window_height = window.innerHeight;

    var window_centrex = window_width/2;
    var window_centrey = window_height/2;

    var fixation_location = "left";
    var fixation_offset = 0;

    let fixation_xpos;
    if (fixation_location == "left") {
        fixation_xpos = (canvas.width/2) - fixation_offset;
    } else {
        fixation_xpos = (canvas.width/2) + fixation_offset;
    };

    var fixation_ypos = window_centrey;

    var circle_xpos_window = canvas_width/2;
    var circle_ypos_window = canvas_height/2;

    var circle_size = 20;
    var circle_colour = "#808080";

    var fixation_size = 40;
    var fixation_colour = "#ff0000";

    //development functions (check all false when running experiment)

    const assist_centre = false;

    function onShow() { //define variables here

        const Circle1 = new CollisionCircles(circle_xpos_window, circle_ypos_window, circle_size, circle_colour);
        const FixationCross1 = new FixationCross(fixation_xpos, fixation_ypos, fixation_size, fixation_colour);

        
        this.objects = Circle1;
        this.FixationCross = FixationCross1;
        window.requestAnimationFrame(this.drawScene);

    };

    this.drawScene = function() { //play the animation here

        

        this.objects.draw(canvas);
        this.objects.movecircle1tocentre();



        //leave as is

        if (assist_centre == true) {
        var ctx = canvas.getContext("2d");
        ctx.beginPath();
        ctx.fillStyle = "#000000";
        ctx.arc(canvas.width/2, canvas.height/2, 10, 0, 2 * Math.PI);
        ctx.fill();
        };

        window.requestAnimationFrame(this.drawScene)

    }

    //add functions below

    function CollisionCircles(xpos, ypos, size, colour) {
        this.xpos = xpos;
        this.ypos = ypos;
        this.size = size;
        this.colour = colour;

        this.distance = 50;
        this.radian = 0;
        this.overlap = 1;

        this.centrex = this.xpos;
        this.centrey = this.ypos;

        this.startx = this.centrex - Math.cos(this.radian)*this.distance;
        this.starty = this.centrey + Math.sin(this.radian)*this.distance;

        this.endx = this.centrex + Math.cos(this.radian)*this.distance;
        this.endy = this.centrey - Math.sign(this.radian)*this.distance;

        this.circle1x = this.startx - Math.cos(this.radian)*this.size;
        this.circle1y = this.starty + Math.sin(this.radian)*this.size;

        this.circle2x = this.centrex - Math.cos(this.radian)*((this.size)*(this.overlap)); 
        this.circle2y = this.centrey + Math.sin(this.radian)*((this.size)*(this.overlap));
        
        this.draw = function(canvas) {
            var ctx = canvas.getContext("2d");

            ctx.beginPath();
            ctx.fillStyle = this.colour;
            ctx.arc(this.circle1x, this.circle1y, this.size, 0, 2 * Math.PI);
            ctx.fill();

            ctx.beginPath();
            ctx.fillStyle = "blue";
            ctx.arc(this.circle2x, this.circle2y, this.size, 0, 2 * Math.PI);
            ctx.fill();
        };

        this.movecircle1tocentre = function() {

            var speed = 1

            var distanceX = Math.abs(this.circle1x - (this.centrex - Math.cos(this.radian)*((this.size))))
            var distanceY = Math.abs(this.circle1y - (this.centrey + Math.sin(this.radian)*((this.size))))

            if (distanceX > 0) {
                this.circle1x = this.circle1x + Math.cos(this.radian)*speed;
                this.circle1y = this.circle1y - Math.sin(this.radian)*speed;    
            }
            

        }
    };

    function FixationCross(xpos, ypos, size, colour) {
        this.xpos = xpos;
        this.ypos = ypos;
        this.size = size;
        this.colour = colour;

        this.rec1sizex = this.size;
        this.rec1sizey = this.size/4;
        this.rec1x = this.xpos - this.rec1sizex/2;
        this.rec1y = this.ypos - this.rec1sizey/2;

        this.rec2sizex = this.size/4;
        this.rec2sizey = this.size;
        this.rec2x = this.xpos - this.rec2sizex/2;
        this.rec2y = this.ypos - this.rec2sizey/2;

        this.draw = function(canvas) {
            var ctx = canvas.getContext("2d");

            ctx.fillStyle = this.colour;
            ctx.fillRect(this.rec1x, this.rec1y, this.rec1sizex, this.rec1sizey);
            ctx.fillRect(this.rec2x, this.rec2y, this.rec2sizex, this.rec2sizey);
        };
    };
</script>
</body>
</html>